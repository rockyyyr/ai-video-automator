const captions = [{ "word": "Imagine", "start_time": 0.225, "end_time": 0.7375 }, { "word": "boarding", "start_time": 0.7375, "end_time": 1.075 }, { "word": "a", "start_time": 1.075, "end_time": 1.1875 }, { "word": "plane", "start_time": 1.1875, "end_time": 1.85 }, { "word": "—", "start_time": 1.85, "end_time": 1.95 }, { "word": "only", "start_time": 1.95, "end_time": 2.275 }, { "word": "to", "start_time": 2.275, "end_time": 2.3625 }, { "word": "be", "start_time": 2.3625, "end_time": 2.4875 }, { "word": "seated", "start_time": 2.4875, "end_time": 2.8375 }, { "word": "on", "start_time": 2.8375, "end_time": 2.9375 }, { "word": "the", "start_time": 2.9375, "end_time": 3.05 }, { "word": "outside", "start_time": 3.05, "end_time": 4.025 }, { "word": ".", "start_time": 4.025, "end_time": 4.125 }, { "word": "This", "start_time": 4.125, "end_time": 4.425 }, { "word": "is", "start_time": 4.425, "end_time": 4.575 }, { "word": "the", "start_time": 4.575, "end_time": 4.725 }, { "word": "future", "start_time": 4.725, "end_time": 5.1875 }, { "word": "of", "start_time": 5.1875, "end_time": 5.3625 }, { "word": "air", "start_time": 5.3625, "end_time": 5.6 }, { "word": "travel", "start_time": 5.6, "end_time": 6.3 }, { "word": ".", "start_time": 6.3, "end_time": 6.375 }, { "word": "With", "start_time": 6.375, "end_time": 6.5875 }, { "word": "billions", "start_time": 6.5875, "end_time": 7.075 }, { "word": "in", "start_time": 7.075, "end_time": 7.2625 }, { "word": "funding", "start_time": 7.2625, "end_time": 7.675 }, { "word": "from", "start_time": 7.675, "end_time": 7.8375 }, { "word": "the", "start_time": 7.8375, "end_time": 7.9625 }, { "word": "Sudanese", "start_time": 7.9625, "end_time": 8.55 }, { "word": "government", "start_time": 8.55, "end_time": 9.225 }, { "word": ",", "start_time": 9.225, "end_time": 9.325 }, { "word": "engineers", "start_time": 9.325, "end_time": 9.975 }, { "word": "have", "start_time": 9.975, "end_time": 10.125 }, { "word": "discovered", "start_time": 10.125, "end_time": 10.775 }, { "word": "that", "start_time": 10.775, "end_time": 10.925 }, { "word": "mounting", "start_time": 10.925, "end_time": 11.35 }, { "word": "passengers", "start_time": 11.35, "end_time": 12.1625 }, { "word": "to", "start_time": 12.1625, "end_time": 12.2625 }, { "word": "the", "start_time": 12.2625, "end_time": 12.4 }, { "word": "exterior", "start_time": 12.4, "end_time": 13.025 }, { "word": "reduces", "start_time": 13.025, "end_time": 13.6375 }, { "word": "weight", "start_time": 13.6375, "end_time": 14.225 }, { "word": ",", "start_time": 14.225, "end_time": 14.325 }, { "word": "cutting", "start_time": 14.325, "end_time": 14.6875 }, { "word": "fuel", "start_time": 14.6875, "end_time": 15.0125 }, { "word": "costs", "start_time": 15.0125, "end_time": 15.6875 }, { "word": "by", "start_time": 15.6875, "end_time": 15.8875 }, { "word": "47%", "start_time": 15.8875, "end_time": 17.35 }, { "word": ".", "start_time": 17.35, "end_time": 17.525 }, { "word": "The", "start_time": 17.724999999999998, "end_time": 17.799999999999997 }, { "word": "cabin", "start_time": 17.799999999999997, "end_time": 18.2 }, { "word": "will", "start_time": 18.2, "end_time": 18.3125 }, { "word": "be", "start_time": 18.3125, "end_time": 18.4375 }, { "word": "filled", "start_time": 18.4375, "end_time": 18.775 }, { "word": "with", "start_time": 18.775, "end_time": 18.95 }, { "word": "helium", "start_time": 18.95, "end_time": 19.487499999999997 }, { "word": "and", "start_time": 19.487499999999997, "end_time": 19.662499999999998 }, { "word": "birds", "start_time": 19.662499999999998, "end_time": 20.3375 }, { "word": "to", "start_time": 20.3375, "end_time": 20.487499999999997 }, { "word": "further", "start_time": 20.487499999999997, "end_time": 20.849999999999998 }, { "word": "reduce", "start_time": 20.849999999999998, "end_time": 21.287499999999998 }, { "word": "weight", "start_time": 21.287499999999998, "end_time": 22.049999999999997 }, { "word": ".", "start_time": 22.049999999999997, "end_time": 22.15 }, { "word": "Each", "start_time": 22.15, "end_time": 22.4375 }, { "word": "passenger", "start_time": 22.4375, "end_time": 23.162499999999998 }, { "word": "is", "start_time": 23.162499999999998, "end_time": 23.3375 }, { "word": "fitted", "start_time": 23.3375, "end_time": 23.724999999999998 }, { "word": "with", "start_time": 23.724999999999998, "end_time": 23.862499999999997 }, { "word": "a", "start_time": 23.862499999999997, "end_time": 23.95 }, { "word": "latex", "start_time": 23.95, "end_time": 24.7125 }, { "word": "and", "start_time": 24.7125, "end_time": 24.849999999999998 }, { "word": "aluminum", "start_time": 24.849999999999998, "end_time": 25.375 }, { "word": "bodysuit", "start_time": 25.375, "end_time": 26.1875 }, { "word": "called", "start_time": 26.1875, "end_time": 26.487499999999997 }, { "word": "the", "start_time": 26.487499999999997, "end_time": 26.575 }, { "word": "Alumi-latex", "start_time": 26.575, "end_time": 27.487499999999997 }, { "word": "Integrated", "start_time": 27.487499999999997, "end_time": 28.099999999999998 }, { "word": "Delivery", "start_time": 28.099999999999998, "end_time": 28.5 }, { "word": "System", "start_time": 28.5, "end_time": 29.1875 }, { "word": "—", "start_time": 29.1875, "end_time": 29.275 }, { "word": "or", "start_time": 29.275, "end_time": 29.412499999999998 }, { "word": "AIDS", "start_time": 29.412499999999998, "end_time": 30.15 }, { "word": ".", "start_time": 30.15, "end_time": 30.325 }, { "word": "Once", "start_time": 30.55, "end_time": 30.8 }, { "word": "given", "start_time": 30.8, "end_time": 31.099999999999998 }, { "word": "AIDS", "start_time": 31.099999999999998, "end_time": 31.675 }, { "word": ",", "start_time": 31.675, "end_time": 31.775 }, { "word": "passengers", "start_time": 31.775, "end_time": 32.35 }, { "word": "are", "start_time": 32.35, "end_time": 32.45 }, { "word": "bolted", "start_time": 32.45, "end_time": 32.85 }, { "word": "directly", "start_time": 32.85, "end_time": 33.375 }, { "word": "to", "start_time": 33.375, "end_time": 33.4625 }, { "word": "the", "start_time": 33.4625, "end_time": 33.6 }, { "word": "underside", "start_time": 33.6, "end_time": 34.15 }, { "word": "of", "start_time": 34.15, "end_time": 34.2375 }, { "word": "the", "start_time": 34.2375, "end_time": 34.3625 }, { "word": "wings", "start_time": 34.3625, "end_time": 34.825 }, { "word": "and", "start_time": 34.825, "end_time": 34.9625 }, { "word": "fuselage", "start_time": 34.9625, "end_time": 36.05 }, { "word": ".", "start_time": 36.05, "end_time": 36.1625 }, { "word": "Urine", "start_time": 36.1625, "end_time": 36.575 }, { "word": "and", "start_time": 36.575, "end_time": 36.7125 }, { "word": "feces", "start_time": 36.7125, "end_time": 37.2125 }, { "word": "tubes", "start_time": 37.2125, "end_time": 37.7125 }, { "word": "are", "start_time": 37.7125, "end_time": 37.825 }, { "word": "then", "start_time": 37.825, "end_time": 38.025 }, { "word": "installed", "start_time": 38.025, "end_time": 38.725 }, { "word": "into", "start_time": 38.725, "end_time": 38.9375 }, { "word": "the", "start_time": 38.9375, "end_time": 39.025 }, { "word": "passengers", "start_time": 39.025, "end_time": 39.6375 }, { "word": "rectum", "start_time": 39.6375, "end_time": 40.1375 }, { "word": "and", "start_time": 40.1375, "end_time": 40.275 }, { "word": "urethra", "start_time": 40.275, "end_time": 41.15 }, { "word": ",", "start_time": 41.15, "end_time": 41.25 }, { "word": "recycling", "start_time": 41.25, "end_time": 41.875 }, { "word": "passenger", "start_time": 41.875, "end_time": 42.3875 }, { "word": "waste", "start_time": 42.3875, "end_time": 42.85 }, { "word": "into", "start_time": 42.85, "end_time": 43.1 }, { "word": "breathable", "start_time": 43.1, "end_time": 43.65 }, { "word": "air", "start_time": 43.65, "end_time": 44.2875 }, { "word": "with", "start_time": 44.2875, "end_time": 44.4375 }, { "word": "a", "start_time": 44.4375, "end_time": 44.5375 }, { "word": "feces", "start_time": 44.5375, "end_time": 45 }, { "word": "to", "start_time": 45, "end_time": 45.1625 }, { "word": "air", "start_time": 45.1625, "end_time": 45.4 }, { "word": "ratio", "start_time": 45.4, "end_time": 46.225 }, { "word": "of", "start_time": 46.225, "end_time": 46.4 }, { "word": "less", "start_time": 46.4, "end_time": 46.9 }, { "word": "than", "start_time": 46.9, "end_time": 47.075 }, { "word": "1", "start_time": 47.075, "end_time": 47.349999999999994 }, { "word": "to", "start_time": 47.349999999999994, "end_time": 47.4875 }, { "word": "14", "start_time": 47.4875, "end_time": 48.4 }, { "word": ".", "start_time": 48.4, "end_time": 48.575 }, { "word": "In-flight", "start_time": 48.775000000000006, "end_time": 49.25 }, { "word": "meals", "start_time": 49.25, "end_time": 49.8125 }, { "word": "will", "start_time": 49.8125, "end_time": 49.962500000000006 }, { "word": "include", "start_time": 49.962500000000006, "end_time": 50.4125 }, { "word": "chicken", "start_time": 50.4125, "end_time": 51.2 },
{ "word": ".", "start_time": 51.2, "end_time": 51.337500000000006 },
{ "word": ";", "start_time": 51.337500000000006, "end_time": 51.375 },
{ "word": "So", "start_time": 48.800000000000004, "end_time": 48.95 },
{ "word": "what", "start_time": 48.95, "end_time": 49.087500000000006 },
{ "word": "do", "start_time": 49.087500000000006, "end_time": 49.212500000000006 }, { "word": "you", "start_time": 49.212500000000006, "end_time": 49.337500000000006 }, { "word": "think", "start_time": 49.337500000000006, "end_time": 49.875 }, { "word": "?", "start_time": 49.875, "end_time": 49.975 }, { "word": "Would", "start_time": 49.975, "end_time": 50.125 }, { "word": "you", "start_time": 50.125, "end_time": 50.2625 }, { "word": "fly", "start_time": 50.2625, "end_time": 50.5625 }, { "word": "on", "start_time": 50.5625, "end_time": 50.6625 }, { "word": "the", "start_time": 50.6625, "end_time": 50.800000000000004 }, { "word": "outside", "start_time": 50.800000000000004, "end_time": 51.237500000000004 }, { "word": "of", "start_time": 51.237500000000004, "end_time": 51.3125 }, { "word": "a", "start_time": 51.3125, "end_time": 51.4125 }, { "word": "plane", "start_time": 51.4125, "end_time": 52.075 }, { "word": "?", "start_time": 52.075, "end_time": 52.175000000000004 }, { "word": "Let", "start_time": 52.175000000000004, "end_time": 52.337500000000006 }, { "word": "us", "start_time": 52.337500000000006, "end_time": 52.5 }, { "word": "know", "start_time": 52.5, "end_time": 52.800000000000004 }, { "word": "in", "start_time": 52.800000000000004, "end_time": 52.9125 }, { "word": "the", "start_time": 52.9125, "end_time": 53.0125 }, { "word": "comments", "start_time": 53.0125, "end_time": 53.800000000000004 }, { "word": "!", "start_time": 53.800000000000004, "end_time": 53.95 }];

console.log(chuckScriptIntoScenes(captions, 5));

function roundTo(value, precision) {
    const factor = Math.pow(10, precision);
    return Math.round(value * factor) / factor;
};

function chuckScriptIntoScenes(captions, timeInSeconds) {
    let scenes = [];
    let currentWords = [];
    let currentScene = 1;
    let sceneStartTime = 0;

    for (let i = 0; i < captions.length; i++) {
        const { word, end_time } = captions[i];

        currentWords.push(word);

        if (end_time - sceneStartTime >= timeInSeconds || i === captions.length - 1) {
            scenes.push({
                id: currentScene++,
                words: currentWords.join(' '),
                duration: roundTo(end_time - sceneStartTime, 2),
            });

            sceneStartTime = end_time;
            currentWords = [];
        }
    }

    const finalScene = scenes[scenes.length - 1];

    if (finalScene.duration < 2.5) {
        const scene = scenes.pop();
        scenes[scenes.length - 1].words += ' ' + scene.words;
        scenes[scenes.length - 1].duration = roundTo(scenes[scenes.length - 1].duration + scene.duration, 2);
    }

    if (scenes.length > 0) {
        scenes[scenes.length - 1].duration += 0.3;
    }

    const totalDuration = scenes.reduce((acc, scene) => acc + scene.duration, 0);

    return {
        segments: scenes,
        totalDuration: roundTo(totalDuration, 2)
    };
}